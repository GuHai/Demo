<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.yskj.dao.UserDao" >	<!-- 查询字段 -->	<sql id="columnList" >		su.id,su.birthday,su.pinyin,		su.accountNo, su.password, su.weChatNo, su.nickName, su.sex, su.phoneNumber , su.lastLoginTime, su.loginTime, su.status, su.realName, INSERT(su.IDCard,7,8,"********")IDCard, su.infoHeadImg, su.userSig, su.createTime, su.updateTime, su.version, su.isDeleted, su.createBy, su.updateBy, su.locked	</sql>	<!--通过id集合in查询-->	<sql id="inClause">		<if test="column!=null">			<if test="ids==null">				and 1=0			</if>			<if test="ids!=null">				<if test="ids.size>0">					and  su.${column} in					<foreach item="items" index="index" collection="ids" open="(" separator="," close=")">						#{items}					</foreach>				</if>				<if test="ids.size==0">					and 1=0				</if>			</if>		</if>	</sql>	<!-- 查询条件 -->	<sql id="whereClause">		where 1=1		<trim  suffixOverrides="," >			<if test="condition.id != null" >				and su.id = #{condition.id}			</if>			<if test="condition.birthday != null" >and  su.birthday = #{condition.birthday}</if>			<if test="condition.accountNo != null" >and  su.accountNo = #{condition.accountNo}</if>			<if test="condition.password != null" >and  su.password = #{condition.password}</if>			<if test="condition.weChatNo != null" >and  su.weChatNo = #{condition.weChatNo}</if>			<if test="condition.nickName != null" >and  su.nickName = #{condition.nickName}</if>			<if test="condition.sex != null" >and  su.sex = #{condition.sex}</if>			<if test="condition.phoneNumber != null" >and  su.phoneNumber = #{condition.phoneNumber}</if>			<if test="condition.lastLoginTime != null" >and  su.lastLoginTime = #{condition.lastLoginTime}</if>			<if test="condition.loginTime != null" >and  su.loginTime = #{condition.loginTime}</if>			<if test="condition.status != null" >and  su.status = #{condition.status}</if>			<if test="condition.realName != null" >and  su.realName = #{condition.realName}</if>			<if test="condition.IDCard != null" >and  su.IDCard = #{condition.IDCard}</if>			<if test="condition.infoHeadImg != null" >and  su.infoHeadImg = #{condition.infoHeadImg}</if>			<if test="condition.userSig != null" >and  su.userSig = #{condition.userSig}</if>			<if test="condition.createTime != null" >and  su.createTime = #{condition.createTime}</if>			<if test="condition.updateTime != null" >and  su.updateTime = #{condition.updateTime}</if>			<if test="condition.version != null" >and  su.version = #{condition.version}</if>			<if test="condition.isDeleted != null" >and  su.isDeleted = #{condition.isDeleted}</if>			<if test="condition.createBy != null" >and  su.createBy = #{condition.createBy}</if>			<if test="condition.updateBy != null" >and  su.updateBy = #{condition.updateBy}</if>			<if test="condition.locked != null" >and  su.locked = #{condition.locked}</if>		</trim>		<include refid="inClause"/>	</sql>	<!-- 模糊查询条件 -->	<sql id="whereLikeClause">		where 1=1		<trim  suffixOverrides="," >			<if test="condition.id != null" >				and su.id = #{condition.id}			</if>			<if test="condition.birthday != null" >and  UPPER(su.birthday) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.birthday}),'%'))</if>			<if test="condition.accountNo != null" >and  UPPER(su.accountNo) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.accountNo}),'%'))</if>			<if test="condition.password != null" >and  UPPER(su.password) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.password}),'%'))</if>			<if test="condition.weChatNo != null" >and  UPPER(su.weChatNo) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.weChatNo}),'%'))</if>			<if test="condition.nickName != null" >and  UPPER(su.nickName) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.nickName}),'%'))</if>			<if test="condition.sex != null" >and  UPPER(su.sex) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.sex}),'%'))</if>			<if test="condition.phoneNumber != null" >and  UPPER(su.phoneNumber) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.phoneNumber}),'%'))</if>			<if test="condition.lastLoginTime != null" >and  UPPER(su.lastLoginTime) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.lastLoginTime}),'%'))</if>			<if test="condition.loginTime != null" >and  UPPER(su.loginTime) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.loginTime}),'%'))</if>			<if test="condition.status != null" >and  UPPER(su.status) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.status}),'%'))</if>			<if test="condition.realName != null" >and  UPPER(su.realName) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.realName}),'%'))</if>			<if test="condition.IDCard != null" >and  UPPER(su.IDCard) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.IDCard}),'%'))</if>			<if test="condition.infoHeadImg != null" >and  UPPER(su.infoHeadImg) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.infoHeadImg}),'%'))</if>			<if test="condition.userSig != null" >and  UPPER(su.userSig) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.userSig}),'%'))</if>			<if test="condition.createTime != null" >and  UPPER(su.createTime) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.createTime}),'%'))</if>			<if test="condition.updateTime != null" >and  UPPER(su.updateTime) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.updateTime}),'%'))</if>			<if test="condition.version != null" >and  UPPER(su.version) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.version}),'%'))</if>			<if test="condition.isDeleted != null" >and  UPPER(su.isDeleted) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.isDeleted}),'%'))</if>			<if test="condition.createBy != null" >and  UPPER(su.createBy) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.createBy}),'%'))</if>			<if test="condition.updateBy != null" >and  UPPER(su.updateBy) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.updateBy}),'%'))</if>			<if test="condition.locked != null" >and  UPPER(su.locked) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.locked}),'%'))</if>		</trim>		<include refid="inClause"/>	</sql>	<!-- 插入记录 -->	<insert id="add"  >		insert into shiro_user (id,birthday,pinyin,accountNo,password,weChatNo,nickName,sex,phoneNumber,lastLoginTime,loginTime,status,realName,IDCard,infoHeadImg,userSig,createTime,updateTime,version,isDeleted,createBy,updateBy,locked)		values(#{id,jdbcType=VARCHAR},#{birthday},#{pinyin},#{accountNo},#{password},#{weChatNo},#{nickName},#{sex},#{phoneNumber},#{lastLoginTime},#{loginTime},#{status},#{realName},#{IDCard},#{infoHeadImg},#{userSig},#{createTime},#{updateTime},#{version},#{isDeleted},#{createBy},#{updateBy},#{locked})	</insert>	<!-- 修改记录，只修改只不为空的字段 -->	<update id="update" >		update shiro_user set		<trim  suffixOverrides="," >			<if test="birthday != null ">birthday=#{birthday},</if>			<if test="accountNo != null ">accountNo=#{accountNo},</if>			<if test="password != null ">password=#{password},</if>			<if test="weChatNo != null ">weChatNo=#{weChatNo},</if>			<if test="nickName != null ">nickName=#{nickName},</if>			<if test="sex != null ">sex=#{sex},</if>			<if test="phoneNumber != null ">phoneNumber=#{phoneNumber},</if>			<if test="lastLoginTime != null ">lastLoginTime=#{lastLoginTime},</if>			<if test="loginTime != null ">loginTime=#{loginTime},</if>			<if test="status != null ">status=#{status},</if>			<if test="realName != null ">realName=#{realName},</if>			<if test="IDCard != null ">IDCard=#{IDCard},</if>			<if test="infoHeadImg != null ">infoHeadImg=#{infoHeadImg},</if>			<if test="userSig != null ">userSig=#{userSig},</if>			<if test="createTime != null ">createTime=#{createTime},</if>			<if test="updateTime != null ">updateTime=#{updateTime},</if>			<if test="version != null ">version=#{version},</if>			<if test="isDeleted != null ">isDeleted=#{isDeleted},</if>			<if test="createBy != null ">createBy=#{createBy},</if>			<if test="updateBy != null ">updateBy=#{updateBy},</if>			<if test="locked != null ">locked=#{locked},</if>			<if test="pinyin != null ">pinyin=#{pinyin},</if>		</trim> where id=#{id} and version = #{version}-1	</update>	<!-- 删除记录 -->	<delete id="del" >		delete from shiro_user where id = #{id} and version = #{version}	</delete>	<!-- 根据id查询  -->	<select id="get"   resultType="User"  parameterType="String">		select <include refid="columnList" />		from shiro_user  su		where  su.id = #{id}  and su.isDeleted = false	</select>	<!-- 列表总数-->	<select id="count" resultType="java.lang.Long" >		select count(1)		from shiro_user  su		<include refid="whereClause"/>	</select>	<!-- 查询page -->	<select id="findPage" resultType="User" >		select		<include refid="columnList"/>		from shiro_user su		<include refid="whereClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!-- 模糊查询page -->	<select id="findLikePage" resultType="User" >		select		<include refid="columnList"/>		from shiro_user su		<include refid="whereLikeClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!-- 查询列表list -->	<select id="findList" resultMap="UserMap" >		select		<include refid="detailList"/>		from shiro_user su		left join attachment attachment on su.infoHeadImg = attachment.id		left join weixin weixin on su.id = weixin.userID		<include refid="whereClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!--模糊查询list-->	<select id="findLikeList" resultType="User" >		select		<include refid="columnList"/>		from shiro_user su		<include refid="whereLikeClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!-- 查询符合条件的数据的id集合 -->	<select id="findIds" resultType="String">		select su.id		from shiro_user su		<include refid="whereClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!-- 查询符合模糊条件的数据的id集合 -->	<select id="findLikeIds" resultType="String">		select su.id		from shiro_user su		<include refid="whereLikeClause"/>		<if test="orderByClause!=null">${orderByClause}</if>	</select>	<!-- 获取一个对象通过非id -->	<select id="one" resultMap="UserMap" >		select		<include refid="detailList"/>		from shiro_user su		left join attachment attachment on su.infoHeadImg = attachment.id		left join weixin weixin on su.id = weixin.userID		<include refid="whereClause"/>		<if test="orderByClause!=null">${orderByClause}</if>		limit 0,1	</select>	<!--如果你想返回一个HashMap 就实现这个select标签--><select id="queryHashMap" resultType="java.util.HashMap">	select * from shiro_user;</select><!--通过账号查找--><select id="getByAccountNo" resultType="User">	select <include refid="columnList"/> from shiro_user su  where su.accountNo  = #{accountNo} limit 0,1</select>	<!--级联查询-->	<sql id="detailList">		su.id as 'id',su.version as 'version',su.birthday as 'birthday',su.version as 'version',su.accountNo as 'accountNo',su.password as 'password',su.weChatNo as 'weChatNo',su.nickName as 'nickName',su.sex as 'sex',su.phoneNumber as 'phoneNumber',su.lastLoginTime as 'lastLoginTime',su.loginTime as 'loginTime',su.status as 'status',su.realName as 'realName',su.IDCard as 'IDCard',su.infoHeadImg as 'infoHeadImg',su.userSig as 'userSig',		su.locked as 'locked',		attachment.id as 'attachment.id',attachment.datestr as 'attachment.datestr',attachment.path as 'attachment.path',attachment.name as 'attachment.name',attachment.title as 'attachment.title',attachment.type as 'attachment.type',	    weixin.id as 'weixin.id',        weixin.version as 'weixin.version',weixin.nickname as 'weixin.nickname',weixin.sex as 'weixin.sex',weixin.province as 'weixin.province',weixin.city as 'weixin.city',weixin.country as 'weixin.country',weixin.headimgurl as 'weixin.headimgurl',weixin.privilegeStr as 'weixin.privilegeStr',weixin.unionid as 'weixin.unionid',weixin.openid as 'weixin.openid',weixin.userID as 'weixin.userID',weixin.refreshToken as 'weixin.refreshToken',weixin.accessToken as 'weixin.accessToken',weixin.refreshTokenTime as 'weixin.refreshTokenTime',weixin.accessTokenTime as 'weixin.accessTokenTime'    </sql>    <!--Weixin映射-->    <resultMap id="WeixinMap" type="Weixin">        <id property="id" column="weixin.id" />        <result property="version" column="weixin.version" />        <result property="nickname" column="weixin.nickname" />        <result property="sex" column="weixin.sex" />        <result property="province" column="weixin.province" />        <result property="city" column="weixin.city" />        <result property="country" column="weixin.country" />        <result property="headimgurl" column="weixin.headimgurl" />        <result property="privilegeStr" column="weixin.privilegeStr" />        <result property="unionid" column="weixin.unionid" />        <result property="openid" column="weixin.openid" />        <result property="userID" column="weixin.userID" />        <result property="refreshToken" column="weixin.refreshToken" />        <result property="accessToken" column="weixin.accessToken" />        <result property="refreshTokenTime" column="weixin.refreshTokenTime" />        <result property="accessTokenTime" column="weixin.accessTokenTime" />		<result property="ticketTime" column="weixin.ticketTime" />        <result property="ticket" column="weixin.ticket" />    </resultMap>    <!--Attachment映射-->	<resultMap id="AttachmentMap" type="Attachment">		<id property="id" column="attachment.id" />		<result property="datestr" column="attachment.datestr" />		<result property="path" column="attachment.path" />		<result property="name" column="attachment.name" />		<result property="title" column="attachment.title" />		<result property="type" column="attachment.type" />	</resultMap>	<!--User映射-->	<resultMap id="UserMap" type="User">		<id property="id" column="id" />		<result property="birthday" column="birthday" />		<result property="version" column="version" />		<result property="accountNo" column="accountNo" />		<result property="password" column="password" />		<result property="weChatNo" column="weChatNo" />		<result property="nickName" column="nickName" />		<result property="sex" column="sex" />		<result property="phoneNumber" column="phoneNumber" />		<result property="lastLoginTime" column="lastLoginTime" />		<result property="loginTime" column="loginTime" />		<result property="status" column="status" />		<result property="realName" column="realName" />		<result property="IDCard" column="IDCard" />		<result property="infoHeadImg" column="infoHeadImg" />		<result property="userSig" column="userSig" />		<result property="locked" column="locked" />		<result property="version" column="version" />		<association property="attachment"  javaType="Attachment" resultMap="AttachmentMap"/>		<association property="weixin"  javaType="Weixin" resultMap="WeixinMap"/>	</resultMap>	<select id="zpPage" resultType="com.yskj.vo.Member">		SELECT			w.id,			su.id as userID,			su.realName,			su.nickName,			su.locked,			t.identityType as role,		    IF(su.userSig is null OR  su.userSig='' ,'添加',su.userSig) as userSig,			p.personPhoneNumber,			p.realName as prealName,			IFNULL(IFNULL(p.realName,su.realName),su.nickName) as mainName,			(select count( p1.id) from position p1 where p1.userID = su.id and p1.type = false) as num,			if(e.id is null ,false,true) as vip		FROM			weixin w		LEFT JOIN shiro_user su ON su.id = w.userID		left join information t on t.userID = w.userID		LEFT JOIN personalauthen p ON p.userID = w.userID		LEFT JOIN enterprisevip e on e.userID = w.userID		WHERE			<!--w.userID IN (				SELECT					t.userID				FROM					information t				WHERE					t.identityType != 3				<if test="condition.role!=null">					and t.identityType = #{condition.role}				</if>			)-->			t.identityType != 3			<if test="condition.keyword!=null">				AND ( UPPER(p.personPhoneNumber) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%'))				OR  UPPER(p.realName) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%'))				OR  UPPER(su.nickName) LIKE UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%')))			</if>			<if test="condition.wIds!=null">				and w.id in (${condition.wIds})			</if>		order by su.updateTime desc	</select>	<select id="qzPage" resultType="java.util.HashMap">		SELECT		w.id,		su.id as userID,		su.realName,		su.nickName,		p.personPhoneNumber,		p.realName as prealName,		IFNULL(IFNULL(p.realName,su.realName),su.nickName) as mainName,		if(part.id is null ,false,true) as vip,		part.`partID`		FROM		weixin w		LEFT JOIN shiro_user su ON su.id = w.userID		LEFT JOIN personalauthen p ON p.userID = su.id		LEFT JOIN partneruser part		ON part.`userID` = su.`id`		WHERE		w.userID IN (		SELECT		t.userID		FROM		information t		WHERE		t.identityType != 3		<if test="condition.role!=null">			and t.identityType = #{condition.role}		</if>		)		<if test="condition.keyword!=null">			AND ( UPPER(p.personPhoneNumber) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%'))			OR  UPPER(p.realName) LIKE   UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%'))			OR  UPPER(su.nickName) LIKE UPPER(CONCAT(CONCAT('%',#{condition.keyword}),'%')))		</if>		order by su.updateTime desc	</select>	<select id="userInfo" resultType="java.util.HashMap" parameterType="String">		 select su.id,ifnull(su.realName,su.nickName) as 'realName',wx.headimgurl as weixinimg, concat(a.path,'/',a.datestr,'/',a.name) as userimg		 from shiro_user su left join weixin wx on su.id = wx.userID		 left join attachment a on su.infoHeadImg = a.id		 where su.id = #{userID}	</select></mapper>